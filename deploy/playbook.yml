---
- name: Deploy saya-today-web Docker Container
  hosts: all
  remote_user: svc_github

  tasks:
    - name: Create a volume
      community.docker.docker_volume:
        name: "{{ saya_today_web_name }}-volume"

    - name: Deploy saya-today-web Docker Container
      community.docker.docker_container:
        name: "{{ saya_today_web_name }}"
        hostname: "{{ saya_today_web_hostname }}"
        image: "ghcr.io/sayaandy/saya-today-web:{{ saya_today_web_tag }}"
        env:
          B2_KEY_ID: "{{ saya_today_web_b2_key_id }}"
          B2_APPLICATION_KEY: "{{ saya_today_web_b2_application_key }}"
          ENVIRONMENT: "{{ saya_today_web_environment }}"
          AUTH_SALT: "{{ saya_today_web_auth_salt }}"
          MAIL_HOST: "{{ saya_today_web_mail_host }}"
          MAIL_ADDRESS: "{{ saya_today_web_mail_address }}"
          MAIL_USERNAME: "{{ saya_today_web_mail_username }}"
          MAIL_PASSWORD: "{{ saya_today_web_mail_password }}"
          MAIL_SALT: "{{ saya_today_web_mail_salt }}"
          FQDN: "{{ saya_today_web_listen_address }}"
        network_mode: caddy
        networks:
          - name: caddy
            ipv4_address: "{{ saya_today_web_ipv4_address }}"
        volumes:
          - "{{ saya_today_web_name }}-volume:/data:rw"
        restart_policy: unless-stopped
      no_log: true
...
